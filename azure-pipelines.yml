trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
# 1️⃣ Checkout code
- checkout: self
  fetchDepth: 1

# 2️⃣ Install PHP
- script: |
    sudo apt-get update
    sudo apt-get install -y php php-cli php-mbstring php-xml php-curl php-zip unzip
    php -v
  displayName: "Install PHP"

# 3️⃣ Install Composer
- script: |
    curl -sS https://getcomposer.org/installer | php
    sudo mv composer.phar /usr/local/bin/composer
    composer --version
  displayName: "Install Composer"

# 4️⃣ Install Laravel dependencies
- script: |
    composer install --no-interaction --prefer-dist
  displayName: "Composer Install"

# 5️⃣ Laravel basic checks
- script: |
    cp .env.example .env || true
    php artisan key:generate || true
  displayName: "Laravel Setup"

# 6️⃣ Success message
- script: echo "✅ Laravel CI Pipeline Completed Successfully"
  displayName: "Pipeline Success"
