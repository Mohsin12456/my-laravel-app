trigger:
- main

variables:
  system.debug: true

pool:
  vmImage: ubuntu-latest

jobs:
- job: LaravelCI
  displayName: "Laravel CI Pipeline"
  steps:

    # Include pre-steps template
    - template: system-pre-steps.yml

    # Laravel CI steps
    - checkout: self
      fetchDepth: 1
      displayName: "Checkout Code"

    - script: |
        sudo apt-get update
        sudo apt-get install -y php php-cli php-mbstring php-xml php-curl php-zip unzip
        php -v
      displayName: "Install PHP"

    - script: |
        curl -sS https://getcomposer.org/installer | php
        sudo mv composer.phar /usr/local/bin/composer
        composer --version
      displayName: "Install Composer"

    - script: |
        composer install --no-interaction --prefer-dist
      displayName: "Composer Install"

    - script: |
        cp .env.example .env || true
        php artisan key:generate || true
      displayName: "Laravel Setup"

    - script: |
        php artisan test
      displayName: "Run Laravel Tests"

    - script: echo "âœ… Laravel CI Pipeline Completed Successfully"
      displayName: "Pipeline Success"
